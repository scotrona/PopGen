---
title: "Project 2"
output: html_document
Author: "Sierra Cotrona Gentry"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
Chapter 6
Much of genetic variation in real populations is the result of random changes rather than evolutionary selection. 

First to consider is a single locus in a diploid organism where a mutation has occurred. We must save the number of individuals to a number N, and ask the number of copies of allele A given that number of individual ranging from O to two times the number of individuals.
```{r}
N<-1
possible<-0:(2*N)
P<-NULL
for(i in possible){
  P<-c(P, dbinom(possible, size = 2*N, prob = i/(2*N)))
}
(Q<-matrix(P,ncol = 2*N+1, byrow = T))
```
Matrix arrangement is favorable, and here we have created a matrix that describes what to expect for each possible allele counts given the starting frequencies. This is a transition matrix.

Creating a starting state matrix object is similar. Matrix multiplication should give the same probabilities in earlier generation transition. 
```{r}
(x<-matrix(c(rep(0,2*N+1)), ncol = 2*N+1, byrow = T))
x[,2]<-1
x
(R<-x%*%Q)
color<- c("brown", "blue", "grey")
shape<-c(15, 19, 17)
g<- rep(1,ncol(R))
plot.new()
plot(x=NULL, xlim=c(1,10),ylim=c(0,1),
            ylab="Probability", xlab="Generations")
legend("bottomleft", legend=c("Extinct", "One copy", "Fixed"),
                              col=color, pch=shape,
                              xpd=TRUE, inset=c(0,1), bty="n")
while(g[1]<=10){
  (R<-R%*%Q)
  g<-g+1
  points(g, R, col=color, pch=shape)
}
```
The while loop above adds generation time and updates the probabilities. 

Now expanding to a small population with a single allele beginning in one individual, the code can be expanded.
```{r}
N<-10
possible<-0:(2*N)
P<-NULL
for(i in possible){
  P<-c(P, dbinom(possible, size = 2*N, prob = i/(2*N)))
}
Q<-matrix(P,ncol = 2*N+1, byrow = T)
x<-matrix(c(rep(0,2*N+1)), ncol = 2*N+1, byrow = T)
x[,2]<-1
R<-x%*%Q
color<- c("brown", rep("blue", ncol(R)-2), "grey")
shape<-c(15, rep(19, ncol(R)-2), 17)
g<- rep(1,ncol(R))
plot(x=NULL, xlim=c(1,100),ylim=c(0,1),
            ylab="Probability", xlab="Generations")
legend("bottomleft", legend=c("Extinct", "Intermediate", "Fixed"),
                              col=unique(color), pch=unique(shape),
                              xpd=TRUE, inset=c(0,1), bty="n")
while(g[1]<100){
  (R<-R%*%Q)
  g<-g+1
  points(g, R, col=color, pch=shape)
}
abline (h=1/(2*N), lwd=2)
abline (h=1-(1/(2*N)), lwd=2, col="orange", lty=2)

```
Now to modify the while loop to save the transition probabilities for each new generation. 
```{r}
N<-16
possible<-0:(2*N)
x<-matrix(c(rep(0,2*N+1)), ncol = 2*N+1, byrow = T)
x[N+1]<-1
P<-NULL
for(i in possible){
  P<-c(P, dbinom(possible, size = 2*N, prob = i/(2*N)))
}
Q<-matrix(P,ncol = 2*N+1, byrow = T)
R<-x%*%Q
Prob <- R
g<- rep(1,ncol(R))
while(g[1]<19){
  (R<-R%*%Q)
  Prob <-rbind(Prob, R)
  g<-g+1
}
persp(x=1:g[1],
      y=possible,
      z=Prob,
      theta=60, phi=20, 
      xlab="Generations", ylab="Number of Alleles",
      zlab="Probability",
      shade=0.3
      )
library(popgenr)
data (fly)
persp(x=1:g[1],
      y=possible,
      z=fly[-1,],
      theta=60, phi=20, 
      xlab="Generations", ylab="Number of Alleles",
      zlab="Probability",
      shade=0.3
      )
```
Population size influences fixation and extinction probabilities of a single allele. Running multiple simulations can demonstrate this phenomenon. 
```{r}
init_p<-0.05
gen<-100
reps<-10
colors<-rainbow(reps)
N<-10
plot(x=NULL, y=NULL, xlim=c(1,gen), ylim=c(0,1),
     xlab="Generations", ylab="Allele Frequency")
for(i in 1:reps) {
  p<-init_p
  for (j in 1:(gen-1)) {
    a<-rbinom(n=1, size=2*N, prob=p[j])
    f<-a/(2*N)
    p<-c(p,f)
  }
  lines(x=1:gen, y=p, lwd=2, col=colors[i])
}
```
We can demonstrate genetic drift in the same way. 

```{r}
init_p<-0.25
gen<-100
reps<-500
colors<-rainbow(reps)
N<-100
plot(x=NULL, y=NULL, xlim=c(1,gen), ylim=c(0,1),
     xlab="Generations", ylab="Allele Frequency")
Freq<-NULL
for(i in 1:reps) {
  p<-init_p
  for (j in 1:(gen-1)) {
    a<-rbinom(n=1, size=2*N, prob=p[j])
    f<-a/(2*N)
    p<-c(p,f)
  }
  Freq<-rbind(Freq,p)
  lines(x=1:gen, y=p, lwd=2, col=colors[i])
}
lines(1:gen, colMeans(Freq), lwd=2, col="black" )
```
We can also graphically represent reduction in genetic diversity over time, a likely result of genetic drift.
```{r}
N<-c(10,50,100)
gen<-100
het_init<-1.0
line<-c(1,2,4)
colors<-c("orange", "black", "cyan")
het<-sapply(1:gen, function(x) het_init*exp(-(x/(2*N))))
plot(x=NULL, xlim=c(1,gen), ylim=c(0,1),
     xlab="Generations", ylab="Genetic Diversity")
for (i in 1:nrow(het)) {
  lines(1:gen, het[i, ], col=colors[i], 
        lty=line[i], lwd=2)
}
legend(x="bottomleft", legend=N, inset=c(0,1), xpd=TRUE,
       bty="n", col=colors, lty=line, lwd=2)
```
There is a decay in heterozygosity that is a result of no new variants introduced to the population in populations not in equilibrium. 
Populations that are healthy have a balance between mutation and drift that allows variation to remain in the population. 

Expected heterozygosity does not always match observed levels, so the concept of effective population size is used to represent the predicted and observed values. To determine we need the probability per base pair that a pair of DNA sequences could form a heterozygote and rate of mutation.
```{r}
H<-0.0006
u<-10^-8
H/(4*u)
```
